# Googleカレンダー連携 動作確認チェックリスト

## 事前準備

### 1. 環境変数の設定
- [ ] `.env`ファイルに`REACT_APP_GOOGLE_CLIENT_ID`を設定
- [ ] `.env`ファイルに`REACT_APP_BACKEND_URL`を設定（デフォルト: http://localhost:8000）

### 2. バックエンドAPIの起動確認
以下のエンドポイントが動作している必要があります：
- [ ] `GET /api/auth/google/login` - Google認証開始URL取得
- [ ] `POST /api/auth/google/callback` - 認証コールバック処理
- [ ] `GET /api/user/calendar-status` - 連携状態取得
- [ ] `POST /api/auth/google/disconnect` - 連携解除

### 3. Google Cloud Console設定
- [ ] OAuth 2.0クライアントIDが作成されている
- [ ] 承認済みリダイレクトURIに`http://localhost:3000/auth/google/callback`が登録されている

## テスト 1: 初回アクセス（未連携状態）

### 確認手順
1. アプリケーションを起動
   ```bash
   npm start
   ```

2. ブラウザで`http://localhost:3000`にアクセス

### 確認ポイント
- [ ] ページが正常に表示される
- [ ] 「Googleカレンダー連携」というタイトルが表示される
- [ ] 「未連携」のステータスバッジが表示される
- [ ] 説明文「Googleカレンダーとの連携を開始するには...」が表示される
- [ ] 「Googleカレンダーと連携する」ボタンが表示される
- [ ] ボタンにGoogleアイコンが表示される

## テスト 2: Google認証フローの開始

### 確認手順
1. 「Googleカレンダーと連携する」ボタンをクリック

### 確認ポイント
- [ ] ボタンクリック時にローディング状態になる
- [ ] バックエンドに`/api/auth/google/login`のリクエストが送信される（開発者ツールのNetworkタブで確認）
- [ ] Googleの認証画面にリダイレクトされる
- [ ] Google認証画面で権限要求が表示される

### エラーケース
- [ ] バックエンドが起動していない場合、エラーメッセージが表示される
- [ ] ネットワークエラー時、適切なエラーメッセージが表示される

## テスト 3: Google認証の許可

### 確認手順
1. Google認証画面でアカウントを選択
2. カレンダーへのアクセス権限を許可

### 確認ポイント
- [ ] 権限許可後、`http://localhost:3000/auth/google/callback?code=...&state=...`にリダイレクトされる
- [ ] コールバックページが表示される
- [ ] 「認証処理中」というメッセージとスピナーが表示される
- [ ] バックエンドに`/api/auth/google/callback`のPOSTリクエストが送信される
- [ ] 処理成功後、「連携成功」アイコン（✓）と「連携が完了しました！」メッセージが表示される
- [ ] 2秒後、自動的にメインページ（`/`）にリダイレクトされる

### エラーケース
- [ ] 認証キャンセル時、エラーメッセージが表示され3秒後にメインページに戻る
- [ ] バックエンドエラー時、適切なエラーメッセージが表示される

## テスト 4: 連携済み状態の表示

### 確認手順
1. メインページに戻った後の表示を確認

### 確認ポイント
- [ ] 「連携済み」のステータスバッジ（緑色の●）が表示される
- [ ] 連携中のGoogleアカウントのメールアドレスが表示される
- [ ] 「Googleカレンダーと連携されています」という説明文が表示される
- [ ] 「連携を解除」ボタン（赤色）が表示される
- [ ] 「Googleカレンダーと連携する」ボタンは表示されない

## テスト 5: 連携状態の取得（ページリロード）

### 確認手順
1. ブラウザをリロード（F5）

### 確認ポイント
- [ ] リロード時に「読み込み中...」が表示される
- [ ] バックエンドに`/api/user/calendar-status`のGETリクエストが送信される
- [ ] 連携済み状態が維持されて表示される
- [ ] メールアドレスが正しく表示される

## テスト 6: 連携解除

### 確認手順
1. 「連携を解除」ボタンをクリック

### 確認ポイント
- [ ] 確認ダイアログ「Googleカレンダーとの連携を解除しますか？」が表示される
- [ ] 「キャンセル」をクリックすると、何も変更されない
- [ ] 「OK」をクリックすると、処理が開始される
- [ ] バックエンドに`/api/auth/google/disconnect`のPOSTリクエストが送信される
- [ ] 解除成功後、アラート「連携を解除しました。」が表示される
- [ ] 未連携状態の画面に戻る
- [ ] 「Googleカレンダーと連携する」ボタンが再度表示される

### エラーケース
- [ ] バックエンドエラー時、エラーメッセージが表示される
- [ ] 連携状態は変更されない

## テスト 7: エラーハンドリング

### バックエンド未起動時
1. バックエンドAPIを停止
2. アプリケーションを操作

**確認ポイント:**
- [ ] 連携状態取得時、エラーでも未連携として扱われる（エラー表示なし）
- [ ] 連携ボタンクリック時、エラーメッセージが表示される
- [ ] 連携解除時、エラーメッセージが表示される

### ネットワークエラー
**確認ポイント:**
- [ ] タイムアウト時、適切なエラーメッセージが表示される
- [ ] ユーザーは再試行できる

## テスト 8: UIとスタイリング

### 確認ポイント
- [ ] レスポンシブデザインが機能している（モバイル・タブレット・デスクトップ）
- [ ] カードが中央に配置されている
- [ ] ボタンのホバー効果が機能している
- [ ] ローディング状態が視覚的に分かりやすい
- [ ] エラーメッセージが視認性の高いスタイルで表示される
- [ ] 日本語のテキストが正しく表示される

## テスト 9: ブラウザ互換性

### 確認ポイント
- [ ] Chrome で正常に動作する
- [ ] Firefox で正常に動作する
- [ ] Edge で正常に動作する
- [ ] Safari で正常に動作する（Macの場合）

## デバッグ方法

### ブラウザ開発者ツール
1. F12キーで開発者ツールを開く
2. **Console タブ**: エラーログを確認
3. **Network タブ**: APIリクエスト/レスポンスを確認
4. **Application タブ**: Cookieやストレージを確認

### よくある問題と解決方法

#### 「CORS error」が表示される
- バックエンドのCORS設定を確認
- `withCredentials: true`が正しく設定されているか確認

#### 「認証URLが取得できない」
- `.env`ファイルの`REACT_APP_BACKEND_URL`を確認
- バックエンドAPIが起動しているか確認

#### 「Google認証画面にリダイレクトされない」
- バックエンドの`/api/auth/google/login`エンドポイントが正しく動作しているか確認
- レスポンスに`authUrl`が含まれているか確認

#### 「コールバック後にエラーになる」
- Google Cloud ConsoleでリダイレクトURIが正しく登録されているか確認
- バックエンドの`/api/auth/google/callback`エンドポイントを確認

## 完了条件

すべてのテストケースが✅になったら、実装完了です！

---

## 実行コマンド

```bash
# 開発サーバー起動
npm start

# ビルド（本番用）
npm run build

# テスト実行
npm test
```

## 環境変数の設定例

```env
REACT_APP_GOOGLE_CLIENT_ID=123456789-abcdefg.apps.googleusercontent.com
REACT_APP_BACKEND_URL=http://localhost:8000
```
